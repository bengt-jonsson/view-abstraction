\begin{figure}[h]
\center
\begin{tikzpicture}[]
\node(top){};
\node(top-head)[linecode] at ($(top.west)+(-60pt,0pt)$) {};
%%%%%%%%%%% struct %%%%%%%%%%%%%%%%


\node[linecode,anchor=south west](struct) at ($(top.east)+(-30pt,0pt)$) { \scriptsize struct Node \scriptsize \{ int data; int topLayer; Node *next[]; bool marked;\}} ;
\begin{pgfonlayer}{background}
 \node[code-bg,fit=(struct)] {};
\end{pgfonlayer}


\node(locate-head)[linecode] at ($(top.west)+(-10pt,-15pt)$) {\scriptsize boolean find(int x, Node* preds[], Node* succs[]):};

\node(locate1)[linenum,anchor=west] at ($(locate-head.west)+(0pt,-10pt)$) {\scriptsize 1};
\node[linecode] at ($(locate1.east)+(0pt,0pt)$) {\scriptsize int mLevel = 0;};

\node(locate2)[linenum] at ($(locate1.east)+(0pt,-10pt)$) {\scriptsize 2};
\node[linecode] at ($(locate2.east)+(0pt,0pt)$) {\scriptsize boolean marked[MAXLEVEL] = {false};};

\node(locate3)[linenum] at ($(locate2.east)+(0pt,-10pt)$) {\scriptsize 3};
\node(code3)[linecode] at ($(locate3.east)+(0pt,0pt)$) {\scriptsize boolean snip;};

\node(locate4)[linenum] at ($(locate3.east)+(0pt,-10pt)$) {\scriptsize 4};
\node(code4)[linecode] at ($(locate4.east)+(0pt,0pt)$) {\scriptsize Node* pred = null, curr = null, succ = null;}; 

\node(locate5)[linenum] at ($(locate4.east)+(0pt,-10pt)$) {\scriptsize 5};
\node[linecode] at ($(locate5.east)+(0pt,0pt)$) {\scriptsize int k; };

\node(locate6)[linenum] at ($(locate5.east)+(0pt,-10pt)$) {\scriptsize 6};
\node[linecode] at ($(locate6.east)+(0pt,0pt)$) {\scriptsize for(int i=0; i<maxThreads; i++)};
 
\node(locate7)[linenum] at ($(locate6.east)+(0pt,-10pt)$) {\scriptsize 7};
\node[linecode] at ($(locate7.east)+(14pt,0pt)$) {\scriptsize Node* pred = null, curr = null, succ = null;};

\node(locate8)[linenum] at ($(locate7.east)+(0pt,-10pt)$) {\scriptsize 8};
\node(code8)[linecode] at ($(locate8.east)+(14pt,0pt)$) {\scriptsize retry:};

\node(locate9)[linenum] at ($(locate8.east)+(0pt,-10pt)$) {\scriptsize 9};
\node[linecode] at ($(locate9.east)+(14pt,0pt)$) {\scriptsize while (true)};

\node(locate10)[linenum] at ($(locate9.east)+(0pt,-10pt)$) {\scriptsize 10};
\node[linecode] at ($(locate10.east)+(21pt,0pt)$) {\scriptsize  pred = head;};

\node(locate11)[linenum] at ($(locate10.east)+(0pt,-10pt)$) {\scriptsize 11};
\node[linecode] at ($(locate11.east)+(21pt,0pt)$) {\scriptsize for (int i = MAXLEVEL; i >= mLevel; i--)};

\node(locate12)[linenum] at ($(locate11.east)+(0pt,-10pt)$) {\scriptsize 12};
\node[linecode] at ($(locate12.east)+(21pt,0pt)$) {\scriptsize curr = pred.next[i];};

\node(locate13)[linenum] at ($(locate12.east)+(0pt,-10pt)$) {\scriptsize 13};
\node[linecode] at ($(locate13.east)+(21pt,0pt)$) {\scriptsize  while (true)};

\node(locate14)[linenum] at ($(locate13.east)+(0pt,-10pt)$) {\scriptsize 14};
\node(code14)[linecode] at ($(locate14.east)+(28pt,0pt)$) {\scriptsize succ = curr.next[i].get(marked);};

\node(locate15)[linenum] at ($(locate14.east)+(0pt,-10pt)$) {\scriptsize 15};
\node[linecode] at ($(locate15.east)+(28pt,0pt)$) {\scriptsize  while (marked[0])};

\node(locate16)[linenum] at ($(locate15.east)+(0pt,-10pt)$) {\scriptsize 16};
\node(code16)[linecode] at ($(locate16.east)+(35pt,0pt)$) {\scriptsize s= CAS(pred.next[i],curr,succ,false,false);};

\node(locate17)[linenum] at ($(locate16.east)+(0pt,-10pt)$) {\scriptsize 17};
\node[linecode] at ($(locate17.east)+(35pt,0pt)$) {\scriptsize if (!s) continue retry;};

\node(locate18)[linenum] at ($(locate17.east)+(0pt,-10pt)$) {\scriptsize 18};
\node[linecode] at ($(locate18.east)+(35pt,0pt)$) {\scriptsize curr = pred.next[i];};


\node(locate19)[linenum] at ($(locate18.east)+(0pt,-10pt)$) {\scriptsize 19};
\node[linecode] at ($(locate19.east)+(35pt,0pt)$) {\scriptsize succ = curr.next[i].get(marked);};

\node(locate21)[linenum] at ($(locate19.east)+(0pt,-10pt)$) {\scriptsize 20};
\node[linecode] at ($(locate21.east)+(28pt,0pt)$) {\scriptsize if (curr.key < x)};

\node(locate22)[linenum] at ($(locate21.east)+(0pt,-10pt)$) {\scriptsize 21};
\node(code22)[linecode] at ($(locate22.east)+(35pt,0pt)$) {\scriptsize pred = curr; curr = succ;};

\node(locate23)[linenum] at ($(locate22.east)+(0pt,-10pt)$) {\scriptsize 22};
\node[linecode] at ($(locate23.east)+(28pt,0pt)$) {\scriptsize else break;};

\node(locate24)[linenum] at ($(locate23.east)+(0pt,-10pt)$) {\scriptsize 23};
\node[linecode] at ($(locate24.east)+(14pt,0pt)$) {\scriptsize  preds[i] = pred;};

\node(locate25)[linenum] at ($(locate24.east)+(0pt,-10pt)$) {\scriptsize 24};
\node[linecode] at ($(locate25.east)+(14pt,0pt)$) {\scriptsize succs[i] = curr;};

\node(locate26)[linenum] at ($(locate25.east)+(0pt,-10pt)$) {\scriptsize 25};
\node[linecode] at ($(locate26.east)+(0pt,0pt)$) {\scriptsize return (curr.key == key);};








\node(bot)[linecode] at ($(locate25.east)+(0pt,-10pt)$) {};
\begin{pgfonlayer}{background}
 \node[code-bg,fit=(locate-head) (code3) (locate14) (code22) (bot) (code16) ]{};
 \end{pgfonlayer}




\end{tikzpicture}

\caption{Description of the find function of the Skip-list algorithm}
\label{ts-stack:fig}
\end{figure}
